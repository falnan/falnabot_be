generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  // provider = "postgresql"
  // provider = "mysql"
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(cuid())
  phoneNumber  String         @unique
  name      String?
  role      Role      @default(client)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  messages  Message[]
  conversationsAsAdmin  Conversation[] @relation("AdminConversations")
  conversationsAsClient Conversation[] @relation("ClientConversations")
}

enum Role {
  admin
  client
}

model Conversation {
  id        String   @id @default(cuid())
  clientId    String
  adminId     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  messages  Message[]
  admin     User     @relation("AdminConversations", fields: [adminId], references: [id])
  client    User     @relation("ClientConversations", fields: [clientId], references: [id])
}

model Message {
  id             String       @id @default(cuid())
  userId         String
  conversationId String
  message        String?
  messageClassification String
  messageType    MessageType  @default(text)
  createdAt      DateTime     @default(now())

  conversation   Conversation @relation(fields: [conversationId], references: [id])
  user           User        @relation(fields:[userId], references: [id])
}

enum MessageType {
  text
  interactive
}