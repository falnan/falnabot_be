generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int    @id @default(autoincrement())
  phoneNumber  String         @unique
  username      String?
  fullName      String?
  title         String?
  profile       String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  messages  Message[]
  conversation    ConversationParticipant[]
}

model Conversation{
  id    Int     @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  messages    Message[]
  participants   ConversationParticipant[]
}

model ConversationParticipant{
  id              Int           @id @default(autoincrement())
  userId          Int
  conversationId  Int

  user            User          @relation(fields: [userId], references: [id])
  conversation    Conversation  @relation(fields: [conversationId], references: [id])

  @@unique([userId, conversationId]) // 1 user tidak boleh join 2x ke conversation sama
}

model Message {
  id             Int       @id @default(autoincrement())
  conversationId    Int
  senderId         Int
  message        String?
  messageClassification String?
  messageType    MessageType  @default(text)
  timestamp   DateTime    @default(now())

   conversation    Conversation   @relation(fields: [conversationId], references: [id])
  sender          User           @relation(fields: [senderId], references: [id])

}

enum MessageType {
  text
  interactive
}